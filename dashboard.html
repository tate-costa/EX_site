<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>
  <h2>Submit New Entry</h2>
  <div id="submissionSection" style="display:none;">
    <label>Event: <input type="text" id="eventInput"></label><br>
    <label>Skill: <input type="text" id="skillInput"></label><br>
    <label>Value: <input type="number" id="valueInput"></label><br>
    <label>Deduction: <input type="number" id="deductionInput"></label><br>
    <button id="submitBtn">Submit</button>

    <h3>Your Previous Submissions</h3>
    <table border="1">
      <thead>
        <tr>
          <th>Event</th><th>Skill</th><th>Value</th><th>Deduction</th><th>Time</th><th>Actions</th>
        </tr>
      </thead>
      <tbody id="userSubmissionTable"></tbody>
    </table>
  </div>

  <script>
    // üîß Firebase Config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    let currentUserId = null;

    // üîê Auth Listener
    auth.onAuthStateChanged(user => {
      if (user) {
        currentUserId = user.uid;
        document.getElementById("submissionSection").style.display = "block";
        loadUserSubmissions();
      } else {
        window.location.href = "index.html";
      }
    });

    // üöÄ Submit Handler
    document.getElementById("submitBtn").onclick = () => {
      const event = document.getElementById("eventInput").value;
      const skill = document.getElementById("skillInput").value;
      const value = parseInt(document.getElementById("valueInput").value);
      const deduction = parseInt(document.getElementById("deductionInput").value);
      const timestamp = Date.now();

      const submission = { event, skill, value, deduction, timestamp };

      const userRef = db.ref('users/' + currentUserId + '/submissions').push();
      userRef.set(submission);

      const globalRef = db.ref('allSubmissions').push();
      globalRef.set({ ...submission, userId: currentUserId });

      // Clear inputs
      document.getElementById("eventInput").value = "";
      document.getElementById("skillInput").value = "";
      document.getElementById("valueInput").value = "";
      document.getElementById("deductionInput").value = "";

      loadUserSubmissions();
    };

    // üìã Load + Render Submissions
    function loadUserSubmissions() {
      const ref = db.ref('users/' + currentUserId + '/submissions').orderByChild('timestamp');
      ref.on('value', snapshot => {
        const tbody = document.getElementById("userSubmissionTable");
        tbody.innerHTML = "";

        const entries = [];
        snapshot.forEach(child => {
          entries.push({ id: child.key, ...child.val() });
        });

        entries.sort((a, b) => b.timestamp - a.timestamp);
        entries.forEach(entry => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td><input value="${entry.event}" onchange="updateField('${entry.id}', 'event', this.value)" /></td>
            <td><input value="${entry.skill}" onchange="updateField('${entry.id}', 'skill', this.value)" /></td>
            <td><input value="${entry.value}" onchange="updateField('${entry.id}', 'value', this.value)" /></td>
            <td><input value="${entry.deduction}" onchange="updateField('${entry.id}', 'deduction', this.value)" /></td>
            <td>${new Date(entry.timestamp).toLocaleString()}</td>
            <td><button onclick="deleteSubmission('${entry.id}')">üóëÔ∏è</button></td>
          `;
          tbody.appendChild(row);
        });
      });
    }

    // ‚úèÔ∏è Update Field
    function updateField(id, field, newValue) {
      const ref = db.ref('users/' + currentUserId + '/submissions/' + id);
      ref.update({ [field]: newValue });
    }

    // ‚ùå Delete Submission
    function deleteSubmission(id) {
      if (confirm("Delete this submission?")) {
        const ref = db.ref('users/' + currentUserId + '/submissions/' + id);
        ref.remove();
      }
    }
  </script>
</body>
</html>
