<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
  <style>
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 8px; border: 1px solid #ccc; text-align: left; }
    .group-color-0 { background-color: #f0f9ff; }
    .group-color-1 { background-color: #e0f7fa; }
    .group-color-2 { background-color: #fce4ec; }
    .group-color-3 { background-color: #f3e5f5; }
    .group-color-4 { background-color: #fff3e0; }
  </style>
</head>
<body>
  <h2>Dashboard</h2>
  <table id="submissionTable">
    <thead>
      <tr>
        <th>Select</th>
        <th>Event</th>
        <th>User</th>
        <th>Data</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button id="deleteSelected">Delete Selected</button>

  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>
  <script>
    const firebaseConfig = { /* your config */ };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const tableBody = document.querySelector('#submissionTable tbody');
    const colorMap = {};
    let colorIndex = 0;

    const colors = ['group-color-0', 'group-color-1', 'group-color-2', 'group-color-3', 'group-color-4'];

    db.collection('submissions').get().then(snapshot => {
      const rows = [];
      snapshot.forEach(doc => {
        const data = doc.data();
        rows.push({ id: doc.id, ...data });
      });

      const groupColor = {};
      rows.forEach(row => {
        const groupKey = row.submissionId || row.timestamp || row.eventName;
        if (!groupColor[groupKey]) {
          groupColor[groupKey] = colors[colorIndex % colors.length];
          colorIndex++;
        }

        const tr = document.createElement('tr');
        tr.classList.add(groupColor[groupKey]);

        tr.innerHTML = `
          <td><input type="checkbox" class="row-select" data-id="${row.id}"></td>
          <td>${row.eventName || ''}</td>
          <td>${row.user || ''}</td>
          <td>${row.data || ''}</td>
          <td><button onclick="deleteRow('${row.id}')">Delete</button></td>
        `;
        tableBody.appendChild(tr);
      });
    });

    function deleteRow(id) {
      if (!confirm('Delete this row?')) return;
      db.collection('submissions').doc(id).delete().then(() => location.reload());
    }

    document.getElementById('deleteSelected').addEventListener('click', () => {
      const selected = Array.from(document.querySelectorAll('.row-select:checked'))
        .map(input => input.dataset.id);

      if (selected.length === 0) return alert('No rows selected.');
      if (!confirm(`Delete ${selected.length} rows?`)) return;

      const batch = db.batch();
      selected.forEach(id => {
        const ref = db.collection('submissions').doc(id);
        batch.delete(ref);
      });

      batch.commit().then(() => location.reload());
    });
  </script>
</body>
</html>
