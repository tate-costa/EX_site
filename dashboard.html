<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Gymnastics Dashboard</title>
  <!-- ‚úÖ Firebase UMD scripts for browser use -->
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background-color: #f9f9f9; }
    .event-panel { margin-bottom: 30px; border: 1px solid #ccc; padding: 15px; border-radius: 6px; background: #fff; }
    .submitBtn { margin-top: 10px; padding: 8px 16px; background-color: #0077cc; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .submitStatus { font-style: italic; color: green; margin-top: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    input[type="text"], input[type="number"] { width: 90%; padding: 4px; }
  </style>
</head>
<body>
  <h1>Welcome to Your Gymnastics Dashboard</h1>
  <div id="dashboard"></div>

  <script>
    // üî• Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyD3cJtk0c42pNAr3tsi_gQ7_9KcQS-HvgA",
      authDomain: "extracker-d2148.firebaseapp.com",
      projectId: "extracker-d2148"
    };
    firebase.initializeApp(firebaseConfig);

    // üì§ Backend URL
    const scriptURL = "https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec";

    // üîê Capture user info
    firebase.auth().onAuthStateChanged(user => {
      if (user) {
        window.currentUser = {
          uid: user.uid,
          email: user.email
        };
        buildDashboard();
      } else {
        window.location.href = "login.html"; // or signup.html
      }
    });

    // üß± Event list
    const events = ["Vault", "Bars", "Beam", "Floor"];

    function buildDashboard() {
      const container = document.getElementById("dashboard");

      events.forEach(event => {
        const panel = document.createElement("div");
        panel.className = "event-panel";

        const title = document.createElement("h2");
        title.textContent = `Event: ${event}`;
        panel.appendChild(title);

        const table = document.createElement("table");
        table.innerHTML = `
          <thead>
            <tr><th>Skill</th><th>Score</th></tr>
          </thead>
          <tbody>
            ${Array.from({ length: 6 }).map(() => `
              <tr>
                <td><input type="text" placeholder="Skill name"></td>
                <td><input type="number" placeholder="Score" step="0.1" min="0" max="10"></td>
              </tr>
            `).join('')}
          </tbody>
        `;
        panel.appendChild(table);

        const submitBtn = document.createElement("button");
        submitBtn.className = "submitBtn";
        submitBtn.textContent = "Submit Scores";

        const statusMsg = document.createElement("p");
        statusMsg.className = "submitStatus";

        submitBtn.addEventListener("click", () => {
          const rows = panel.querySelectorAll("tbody tr");
          const skills = [];

          rows.forEach(row => {
            const name = row.querySelector("input[type='text']").value.trim();
            const score = parseFloat(row.querySelector("input[type='number']").value);
            if (name && !isNaN(score)) {
              skills.push({ name, score });
            }
          });

          if (skills.length === 0) {
            statusMsg.textContent = "Please enter at least one skill and score.";
            return;
          }

          if (!window.currentUser) {
            statusMsg.textContent = "User not authenticated.";
            return;
          }

          fetch(scriptURL, {
            method: "POST",
            body: JSON.stringify({
              user: window.currentUser,
              event: event,
              skills: skills
            }),
            headers: {
              "Content-Type": "application/json"
            }
          })
          .then(res => res.text())
          .then(response => {
            statusMsg.textContent = `‚úÖ Submitted on ${new Date().toLocaleString()}`;
          })
          .catch(err => {
            console.error("Submission error:", err);
            statusMsg.textContent = "‚ùå Submission failed. Try again.";
          });
        });

        panel.appendChild(submitBtn);
        panel.appendChild(statusMsg);
        container.appendChild(panel);
      });
    }
  </script>
</body>
</html>
