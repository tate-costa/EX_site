<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Gymnastics Dashboard</title>
  <style>
    body { font-family: Arial; padding: 20px; background-color: #f4f4f4; }
    .submitBtn, #breakdownBtn { margin-top: 10px; padding: 8px 16px; background-color: #0077cc; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .submitStatus { font-style: italic; color: green; margin-top: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    input[type="text"], input[type="number"] { width: 90%; padding: 4px; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-firestore.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>
</head>
<body>
  <h1>Gymnastics Dashboard</h1>

  <label for="userId">User ID:</label>
  <input type="text" id="userId" placeholder="Enter your user ID">

  <label for="eventSelect">Select Event:</label>
  <select id="eventSelect">
    <option value="">--Choose an event--</option>
    <option value="FX">FX</option>
    <option value="PH">PH</option>
    <option value="SR">SR</option>
    <option value="VT">VT</option>
    <option value="PB">PB</option>
    <option value="HB">HB</option>
  </select>

  <div id="eventForm"></div>
  <button id="breakdownBtn">See Breakdown</button>

  <script>
    const userIdInput = document.getElementById("userId");
    const eventSelect = document.getElementById("eventSelect");
    const eventForm = document.getElementById("eventForm");
    const breakdownBtn = document.getElementById("breakdownBtn");

    breakdownBtn.addEventListener("click", () => {
      const userId = userIdInput.value.trim();
      if (!userId) {
        alert("Please enter your User ID first.");
        return;
      }
      window.location.href = `breakdown.html?user=${encodeURIComponent(userId)}`;
    });

    eventSelect.addEventListener("change", () => {
      const selectedEvent = eventSelect.value;
      eventForm.innerHTML = "";
      if (!selectedEvent) return;

      const table = document.createElement("table");
      table.innerHTML = `
        <thead><tr><th>Skill</th><th>Value</th><th>Deduction</th></tr></thead>
        <tbody>
          ${Array.from({ length: 8 }).map(() => `
            <tr>
              <td><input type="text" placeholder="Skill name"></td>
              <td><input type="number" placeholder="Value" step="0.1" min="0"></td>
              <td><input type="number" placeholder="Deduction" step="0.1" min="0"></td>
            </tr>
          `).join('')}
        </tbody>
      `;
      eventForm.appendChild(table);

      const submitBtn = document.createElement("button");
      submitBtn.className = "submitBtn";
      submitBtn.textContent = "Submit Scores";

      const statusMsg = document.createElement("p");
      statusMsg.className = "submitStatus";

      submitBtn.addEventListener("click", () => {
        const userId = userIdInput.value.trim();
        if (!userId) {
          statusMsg.textContent = "Please enter your User ID.";
          return;
        }

        const rows = table.querySelectorAll("tbody tr");
        const timestamp = new Date().toLocaleString();
        let valid = false;

        rows.forEach(row => {
          const name = row.querySelector("input[type='text']").value.trim();
          const value = parseFloat(row.querySelector("input[placeholder='Value']").value);
          const deduction = parseFloat(row.querySelector("input[placeholder='Deduction']").value);
          if (name && !isNaN(value) && !isNaN(deduction)) {
            valid = true;
            const entry = { timestamp, event: selectedEvent, skill: name, value, deduction };
            db.collection("gymData").doc(userId).collection("entries").add(entry);
          }
        });

        statusMsg.textContent = valid ? `âœ… Submitted on ${timestamp}` : "Please enter at least one complete skill entry.";
      });

      eventForm.appendChild(submitBtn);
      eventForm.appendChild(statusMsg);
    });
  </script>
</body>
</html>
